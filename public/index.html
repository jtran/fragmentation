<!doctype html>
<html lang="en">
<head>
<title>The Grid</title>
<style type="text/css">
html {
background-color: #000;
}
#field {
height: 442px; width: 202px; margin: 10px auto;
position: relative;
}
#field_background {
width: 100%; height: 402px;
position: relative; top: 40px;
background-color: #0E2F38;
}
.block {
height: 18px; width: 18px;
position: absolute;
border-radius: 3px;
-webkit-transition: left 0.1s ease-out, top 0.1s ease-out, opacity 0.1s ease-out, border-radius 0.5s linear;
-moz-transition:    left 0.1s ease-out, top 0.1s ease-out, opacity 0.1s ease-out, border-radius 0.5s linear;
}
.light {
background-color: #fff;
}
.dark {
background-color: #000;
}
.block.light.blue {
box-shadow: 0 0 5px #fff, 0 0 15px #0AD8FF;
}
.block.dark.blue {
box-shadow: 0 0 5px #000, 0 0 15px #0AD8FF;
}
.block.light.orange {
box-shadow: 0 0 5px #fff, 0 0 15px #EA502B;
}
.block.dark.orange {
box-shadow: 0 0 5px #000, 0 0 15px #EA502B;
}
.block.light.yellow {
box-shadow: 0 0 5px #fff, 0 0 15px #FF9D02;
}
.block.dark.yellow {
box-shadow: 0 0 5px #000, 0 0 15px #FF9D02;
}
#tail {
position: absolute;
opacity: 0.9;
background-color: #fff;
border-top-left-radius: 8px;
border-top-right-radius: 8px;
border-bottom-left-radius: 3px;
border-bottom-right-radius: 3px;
}
#tail.blue {
box-shadow: 0 0 5px #fff, 0 0 15px #0AD8FF;
}
#tail.orange {
box-shadow: 0 0 5px #fff, 0 0 15px #EA502B;
}
#tail.yellow {
box-shadow: 0 0 5px #fff, 0 0 15px #FF9D02;
}
.next {
opacity: 0.7;
}
</style>
<script type="text/javascript" src="/javascripts/head-0.96.min.js"></script>
</head>
<body>


<div id="background">
  <div id="field">
    <div id="field_background"></div>
    <div id="tail"></div>
  </div>
</div>

<audio id="music" src="sea-of-simulation.mp3" preload="preload" />

<script type="text/javascript">//<![CDATA[
head.js("/javascripts/jquery-1.6.2.min.js",
        "/javascripts/jquery-ui-1.8.16.custom.min.js");
head.js("/javascripts/underscore-1.1.7.js");
head.js('/util.js');
head.js('/tetromino-engine.js');
head.js("/nowjs/now.js");

var localField;

function sendMessage(msg) {
  now.distributeMessage(msg);
}

function receiveMessage(clientId, name, msg) {
  console.log(name + ": " + msg);
}

function addPlayer(player) {
  console.log("New player joined game", player.id, player);
}

function removePlayer(playerId) {
  console.log("Player left game", playerId);
}

head(function() {
  localField = new PlayingField();

  // Get ready for server events.
  now.ready(function() {
    now.name = 'user-' + randInt(100);
    now.receiveMessage = receiveMessage;
    now.addPlayer = addPlayer;
    now.removePlayer = removePlayer;

    now.joinGame({ name: now.name });
  });

  localField.showNewFloatingBlock();

  $(document).bind('mousedown', function(event) { localField.rotateTheme(); });
  $(document).bind('keydown', function(event) {
//    console.log('keydown', event.which, String.fromCharCode(event.which));
    if (event.which == 37)  localField.moveLeft();
    if (event.which == 39)  localField.moveRight();
    if (event.which == 40)  localField.fall();
    if (event.which == 191) localField.drop(); // slash
    var letter = String.fromCharCode(event.which).toLowerCase();
    if (letter == 'f') localField.curFloating.rotateClockwise();
    if (letter == 'd') localField.curFloating.rotateCounterclockwise();
    if (letter == 'c') localField.drop();
  });

  // Play background music if present.
  var music = $('#music').get(0);
//  if (music) music.play();

  localField.fallTimer = window.setInterval(_.bind(localField.fall, localField), localField.fallInterval());
});
//]]></script>
</body>
</html>
